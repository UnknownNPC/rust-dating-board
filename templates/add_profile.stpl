<!DOCTYPE html>
<html lang="en">

<head>
    <% let head_title="Dodaty" ; %>
        <% include!("./includes/head_body.stpl"); %>
            <link rel="stylesheet" href="static/css/bootstrap-icons.min.css" crossorigin="anonymous">
            <link href="static/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
</head>

<body>
    <% include!("./includes/nav.stpl"); %>

        <div class="container">
            <p class="h1">Нова анкета</p>
            <form action="/add_profile" method="post">
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <input type="text" class="form-control" name="name" id="name_id"
                            value="<%= data_context.name %>" placeholder="Ім'я">
                    </div>
                    <div class="form-group col-md-4">
                        <input placeholder="Зріст" type="number" 
                            class="form-control" name="height" id="height_id" 
                        <% if data_context.height==0 { %>
                            value=""
                        <% } else { %>
                            value="<%= data_context.height %>"
                        <% } %> >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group input-group col-md-4">

                        <div class="input-group-prepend">
                            <span class="input-group-text" id="phone_prefix">+380</span>
                        </div>
                        <input type="text" class="form-control" aria-describedby="phone_prefix" name="phone_number"
                            id="phone_number_id" value="<%= data_context.phone_number %>" placeholder="Телефон">
                    </div>
                    <div class="form-group col-md-4">
                        <select class="custom-select" name="city" id="city_id">
                            <% if data_context.city.is_empty() { %>
                                <option selected>Виберіть місто</option>
                                <% } %>
                                    <% for city in &data_context.all_cities { %>
                                        <option value="<%= city %>">
                                            <% if city=="harkiv" { %>
                                                Харків
                                                <% } else if city=="kiev" { %>
                                                    Київ
                                                    <% } else if city=="odesa" { %>
                                                        Одеса
                                                        <% } else if city=="lviv" { %>
                                                            Львів
                                                            <% } %>
                                        </option>
                                        <% } %>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <textarea class="form-control" name="description" id="description_id"
                            value="<%= data_context.description %>" rows="4" placeholder="Опис"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <div class="file-loading">
                            <input id="photo-files" name="new_profile_photo" type="file" multiple>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-md-12">
                        <button type="submit" class="btn btn-primary mx-auto d-block">Опублікувати</button>
                    </div>
                </div>
            </form>
        </div>

</body>

<% include!("./includes/extra_scripts.stpl"); %>
    <script src="static/js/fileinput.min.js"></script>
    <script src="static/js/locales/ru.js"></script>
    <script src="static/js/locales/ua.js"></script>
    <script>
        $(document).ready(function () {
            var $el1 = $("#photo-files");
            $el1.fileinput({
                uploadUrl: "/profile_photo/upload",
                enableResumableUpload: false,
                maxFileCount: 10,
                duplicate: false,
                maxSize: 15728640,
                allowedFileExtensions: ["jpg", "jpeg"],
                language: 'ua',
                initialPreviewAsData: true,
                overwriteInitial: false,

                initialPreview: [
                    <% for photo_url in & data_context.init_photos.initialPreview { %>
                        "<%= photo_url %>",
                    <% } %>
                ],
                initialPreviewConfig: [
                    <% for init_photo in & data_context.init_photos.initialPreviewConfig { %>
                        {
                            caption: '<%= init_photo.caption %>',
                            width: '120px',
                            url: '<%= init_photo.url %>',
                            key: <%= init_photo.key %>,
                            size: <%= init_photo.size %>
                        },
                    <% } %>
                ],
                browseLabel: "Вибрати світлини",
                dropZoneTitle: "Перетягніть світлини у зону автоматичної загрузки",
                dropZoneClickTitle: "<br\>(або нажміть для вибору файлів)",
                fileActionSettings: {
                    showZoom: false,
                    showRotate: false,
                    showUpload: false,
                    showDrag: false,
                },
                showPause: false,
                showCancel: false,
                showBrowse: false,
                showUpload: false,
                showCaption: false,
                showRemove: false,
                showClose: false,
                browseOnZoneClick: true
            }).on('filebatchselected', function (event, previewId, index, fileId) {
                $el1.fileinput("upload");
            });
        });
    </script>

</html>